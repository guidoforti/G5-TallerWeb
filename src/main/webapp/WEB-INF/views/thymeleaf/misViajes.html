<!DOCTYPE HTML>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/fragments :: head('UnRumbo - Mis Viajes')">
    <th:block th:fragment="extra">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
        <style>
            /* [NUEVOS ESTILOS TEMTICOS] */
            :root {
                --color-primary: #E16A3D;         /* Naranja */
                --color-taupe: #4E3D2F;           /* Marr贸n Oscuro */
                --color-coffee: #734933;          /* Marr贸n Medio */
                --color-danger-persa: #BA3A3A;     /* Rojo Persa */
            }

            .viaje-card {
                transition: transform 0.2s, box-shadow 0.2s;
                border: 1px solid #e9ecef;
                border-radius: 8px;
                overflow: hidden;
            }
            .viaje-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }
            .estado-badge {
                position: absolute;
                top: 10px;
                right: 10px;
                font-size: 0.75rem;
                padding: 0.35rem 0.6rem;
                border-radius: 0.375rem;
                font-weight: 600;
            }
            .ruta-info {
                border-left: 3px solid var(--color-primary); /* Borde Naranja */
                padding-left: 1rem;
            }
            .text-unrumbo {
                color: var(--color-primary);
            }
            .section-title {
                border-bottom: 3px solid var(--color-primary);
                padding-bottom: 0.5rem;
                margin-bottom: 1.5rem;
            }

            /* [ Mapeo de Colores de Estado del Viaje] */
            .badge-proximo { background-color: var(--color-taupe) !important; color: white; } /* Marr贸n Oscuro */
            .badge-en-curso { background-color: var(--color-primary) !important; color: white; } /* Naranja */
            .badge-finalizado { background-color: #6c757d !important; color: white; } /* Gris Neutro */
            .badge-cancelado { background-color: var(--color-danger-persa) !important; color: white; } /* Rojo Persa */

            /* [ Mapeo de Botones] */
            .btn-outline-primary {
                border-color: var(--color-taupe) !important;
                color: var(--color-taupe) !important;
            }
            .btn-outline-primary:hover {
                 background-color: var(--color-taupe) !important;
                 color: white !important;
            }
            .icon-origen { color: var(--color-danger-persa) !important; } /* Rojo Persa */
            .icon-destino { color: var(--color-success-warm) !important; } /* Verde C谩lido */
            .icon-datos { color: var(--color-taupe) !important; } /* Marr贸n Oscuro */

        </style>
    </th:block>
</head>

<body>
<nav th:replace="fragments/navbar_viajero :: navbar"></nav>

<main role="main" class="container py-4" style="margin-top: 100px;">
    <div class="row mb-4">
        <div class="col-12">
            <div class="mb-3">
                <a th:href="@{/viajero/home}" class="btn btn-outline-secondary fw-bold">
                    <i class="bi bi-arrow-left me-1"></i> Volver al Home
                </a>
            </div>

            <h2 class="fw-bold" style="color: var(--color-taupe);">
                <i class="bi bi-car-front-fill me-2"></i> Mis Viajes
            </h2>
            <p class="text-muted">Consulta tus viajes confirmados por su estado</p>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-12">
            <h4 class="section-title" style="color: var(--color-taupe);">
                <i class="bi bi-calendar-check me-2"></i>Viajes Pr贸ximos
            </h4>

            <div class="row" th:if="${not #lists.isEmpty(viajesProximos)}">
                <div class="col-12 mb-4" th:each="viaje : ${viajesProximos}">
                    <div class="card viaje-card">
                        <div class="card-body position-relative">
                            <span class="badge badge-proximo estado-badge">
                                <i class="bi bi-calendar-event me-1"></i> Pr贸ximo
                            </span>

                            <div class="row align-items-center">
                                <div class="col-md-7 ruta-info">
                                    <div class="d-flex flex-column">

                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-geo-alt-fill me-2 icon-origen"></i>
                                            <strong>Origen:</strong>
                                            <span class="ms-2" th:text="${viaje.origenNombre}">Origen</span>
                                        </div>

                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-flag-fill me-2 icon-destino"></i>
                                            <strong>Destino:</strong>
                                            <span class="ms-2" th:text="${viaje.destinoNombre}">Destino</span>
                                        </div>

                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-calendar3 me-2 text-unrumbo"></i>
                                            <strong>Fecha:</strong>
                                            <span class="ms-2" th:text="${viaje.fechaSalida}">Fecha y hora</span>
                                        </div>

                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-person me-2" style="color: var(--color-coffee);"></i>
                                            <strong>Conductor:</strong>
                                            <span class="ms-2" th:text="${viaje.conductorNombre}">Conductor</span>
                                        </div>

                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-currency-dollar me-2 icon-destino"></i>
                                            <strong>Precio:</strong>
                                            <span class="ms-2 fw-bold" style="color: var(--color-success-warm);" th:text="'$' + ${viaje.precio}">$0</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-5 d-flex flex-column justify-content-center align-items-end">
                                    <a th:href="@{/viaje/detalle(id=${viaje.viajeId})}"
                                       class="btn btn-dark fw-bold">
                                        <i class="bi bi-eye me-1"></i> Ver detalles
                                    </a>
                                    <form id="cancelarReservaForm" 
                                        th:action="@{/reserva/cancelar/{id}(id=${viaje.reservaId})}" method="post" class="mt-3">
                                        <button type="button"
                                            class="btn btn-outline-danger fw-bold"
                                            data-bs-toggle="modal"
                                            data-bs-target="#confirmCancelacionModal"> 
                                            <i class="bi bi-x-circle me-1"></i> Cancelar reserva
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row" th:if="${#lists.isEmpty(viajesProximos)}">
                <div class="col-12 text-center py-4">
                    <div class="card border-0 bg-light">
                        <div class="card-body">
                            <i class="bi bi-inbox display-4 text-muted mb-3"></i>
                            <h5 class="text-muted">No ten茅s viajes pr贸ximos.</h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-12">
            <h4 class="section-title" style="color: var(--color-primary);">
                <i class="bi bi-arrow-right-circle me-2"></i>Viajes en Curso
            </h4>

            <div class="row" th:if="${not #lists.isEmpty(viajesEnCurso)}">
                <div class="col-12 mb-4" th:each="viaje : ${viajesEnCurso}">
                    <div class="card viaje-card">
                        <div class="card-body position-relative">
                            <span class="badge badge-en-curso estado-badge">
                                <i class="bi bi-arrow-right-circle me-1"></i> En Curso
                            </span>

                            <div class="row align-items-center">
                                <div class="col-md-7 ruta-info">
                                    <div class="d-flex flex-column">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-geo-alt-fill text-danger me-2"></i>
                                            <strong>Origen:</strong>
                                            <span class="ms-2" th:text="${viaje.origenNombre}">Origen</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-flag-fill text-success me-2"></i>
                                            <strong>Destino:</strong>
                                            <span class="ms-2" th:text="${viaje.destinoNombre}">Destino</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-calendar3 me-2 text-unrumbo"></i>
                                            <strong>Fecha:</strong>
                                            <span class="ms-2" th:text="${viaje.fechaSalida}">Fecha y hora</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-person me-2" style="color: var(--color-coffee);"></i>
                                            <strong>Conductor:</strong>
                                            <span class="ms-2" th:text="${viaje.conductorNombre}">Conductor</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-currency-dollar me-2" style="color: var(--color-secondary);"></i>
                                            <strong>Precio:</strong>
                                            <span class="ms-2 fw-bold" style="color: var(--color-secondary);" th:text="'$' + ${viaje.precio}">$0</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-5 d-flex flex-column justify-content-center align-items-end">
                                    <a th:href="@{/viaje/detalle(id=${viaje.viajeId})}"
                                       class="btn btn-dark fw-bold">
                                        <i class="bi bi-eye me-1"></i> Ver detalles
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row" th:if="${#lists.isEmpty(viajesEnCurso)}">
                <div class="col-12 text-center py-4">
                    <div class="card border-0 bg-light">
                        <div class="card-body">
                            <i class="bi bi-inbox display-4 text-muted mb-3"></i>
                            <h5 class="text-muted">No ten茅s viajes en curso.</h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <h4 class="section-title" style="color: var(--color-coffee);">
                <i class="bi bi-check-circle me-2"></i>Viajes Finalizados
            </h4>

            <div class="row" th:if="${not #lists.isEmpty(viajesFinalizados)}">
                <div class="col-12 mb-4" th:each="viaje : ${viajesFinalizados}">
                    <div class="card viaje-card">
                        <div class="card-body position-relative">
                            <span class="badge badge-finalizado estado-badge">
                                <i class="bi bi-check-circle me-1"></i> Finalizado
                            </span>

                            <div class="row align-items-center">
                                <div class="col-md-7 ruta-info">
                                    <div class="d-flex flex-column">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-geo-alt-fill text-danger me-2"></i>
                                            <strong>Origen:</strong>
                                            <span class="ms-2" th:text="${viaje.origenNombre}">Origen</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-flag-fill text-success me-2"></i>
                                            <strong>Destino:</strong>
                                            <span class="ms-2" th:text="${viaje.destinoNombre}">Destino</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-calendar3 me-2 text-unrumbo"></i>
                                            <strong>Fecha:</strong>
                                            <span class="ms-2" th:text="${viaje.fechaSalida}">Fecha y hora</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-person me-2" style="color: var(--color-coffee);"></i>
                                            <strong>Conductor:</strong>
                                            <span class="ms-2" th:text="${viaje.conductorNombre}">Conductor</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-currency-dollar me-2" style="color: var(--color-secondary);"></i>
                                            <strong>Precio:</strong>
                                            <span class="ms-2 fw-bold" style="color: var(--color-secondary);" th:text="'$' + ${viaje.precio}">$0</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-5 d-flex flex-column justify-content-center align-items-end">
                                    <a th:if="${viaje.valoracionPendiente}"
                                       th:id="'btn-valorar-conductor-' + ${viaje.viajeId}"
                                       th:href="@{/valoraciones/conductor/form(viajeId=${viaje.viajeId})}"
                                       class="btn btn-unrumbo-detail fw-bold mb-2">
                                        <i class="fas fa-star me-1"></i> Valorar Conductor
                                    </a>

                                    <a th:href="@{/viaje/detalle(id=${viaje.viajeId})}"
                                       class="btn btn-dark fw-bold">
                                        <i class="bi bi-eye me-1"></i> Ver detalles
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row" th:if="${#lists.isEmpty(viajesFinalizados)}">
                <div class="col-12 text-center py-4">
                    <div class="card border-0 bg-light">
                        <div class="card-body">
                            <i class="bi bi-inbox display-4 text-muted mb-3"></i>
                            <h5 class="text-muted">No ten茅s viajes finalizados.</h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-12">
            <h4 class="section-title" style="color: var(--color-danger-persa);">
                <i class="bi bi-x-circle me-2"></i>Viajes Cancelados
            </h4>

            <div class="row" th:if="${not #lists.isEmpty(viajesCancelados)}">
                <div class="col-12 mb-4" th:each="viaje : ${viajesCancelados}">
                    <div class="card viaje-card">
                        <div class="card-body position-relative">
                            <span class="badge badge-cancelado estado-badge">
                                <i class="bi bi-x-circle-fill me-1"></i> Cancelado
                            </span>

                            <div class="row align-items-center">
                                <div class="col-md-7 ruta-info">
                                    <div class="d-flex flex-column">
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-geo-alt-fill me-2 icon-origen"></i>
                                            <strong>Origen:</strong>
                                            <span class="ms-2" th:text="${viaje.origenNombre}">Origen</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-flag-fill me-2 icon-destino"></i>
                                            <strong>Destino:</strong>
                                            <span class="ms-2" th:text="${viaje.destinoNombre}">Destino</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-calendar3 me-2 text-unrumbo"></i>
                                            <strong>Fecha Original:</strong>
                                            <span class="ms-2" th:text="${viaje.fechaSalida}">Fecha y hora</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-person me-2" style="color: var(--color-coffee);"></i>
                                            <strong>Conductor:</strong>
                                            <span class="ms-2" th:text="${viaje.conductorNombre}">Conductor</span>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-currency-dollar me-2 icon-destino"></i>
                                            <strong>Precio:</strong>
                                            <span class="ms-2 fw-bold" th:text="'$' + ${viaje.precio}">$0</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-5 d-flex flex-column justify-content-center align-items-end">
                                    <span class="text-danger fw-bold mb-2">
                                        <i class="bi bi-info-circle me-1"></i> La reserva fue cancelada.
                                    </span>
                                    <a th:href="@{/viaje/detalle(id=${viaje.viajeId})}"
                                       class="btn btn-outline-secondary fw-bold">
                                        <i class="bi bi-eye me-1"></i> Ver detalles
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row" th:if="${#lists.isEmpty(viajesCancelados)}">
                <div class="col-12 text-center py-4">
                    <div class="card border-0 bg-light">
                        <div class="card-body">
                            <i class="bi bi-x-octagon display-4 text-muted mb-3"></i>
                            <h5 class="text-muted">No ten茅s viajes cancelados en el historial.</h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
<div class="modal fade" id="confirmCancelacionModal" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="modalLabel">锔 Confirmar Cancelaci贸n</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                驴Est谩s **seguro** que deseas cancelar esta reserva? Esta acci贸n no se puede deshacer.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Volver / No Cancelar</button>
                
                <button type="button" class="btn btn-danger" onclick="document.getElementById('cancelarReservaForm').submit();">
                    S铆, Cancelar Definitivamente
                </button>
            </div>
        </div>
    </div>
</div>
<div th:replace="fragments/fragments :: footer"></div>
<script th:src="@{/webjars/bootstrap/5.2.0/js/bootstrap.bundle.min.js}"></script>
<th:block th:replace="fragments/fragments :: scripts-websocket"></th:block>
</body>
</html>