<!DOCTYPE HTML>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/fragments :: head('UnRumbo - Buscar Viaje')">
    <th:block th:fragment="extra">
    </th:block>
</head>

<body>
<nav th:replace="fragments/fragments :: navbar"></nav>

<main role="main" class="container" style="margin-top: 120px;">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <div class="text-center mb-4">
                        <h4 class="fw-bold text-dark">Buscar Viaje</h4>
                        <p class="text-muted">Encontrá el viaje que necesitás</p>
                    </div>

                    <!-- Mensaje de error -->
                    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Error:</strong> <span th:text="${error}"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>

                    <!-- Mensaje informativo cuando no hay resultados -->
                    <div th:if="${mensaje}" class="alert alert-info alert-dismissible fade show" role="alert">
                        <i class="fas fa-info-circle me-2"></i>
                        <span th:text="${mensaje}"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>

                    <!-- Formulario de búsqueda -->
                    <div id="searchForm">
                        <form th:action="@{/viaje/buscar}" th:object="${busqueda}" method="post">
                            <div class="row">
                                <!-- Ciudad de Origen -->
                                <div class="col-md-6 mb-3">
                                    <label for="nombreCiudadOrigen" class="form-label">Ciudad de Origen *</label>
                                    <select id="nombreCiudadOrigen"
                                            th:field="*{nombreCiudadOrigen}"
                                            class="form-control"
                                            placeholder="Ej: Buenos Aires"
                                            required>
                                    </select>
                                    <small class="form-text text-muted">
                                        Escribí para buscar tu ciudad de origen
                                    </small>
                                </div>

                                <!-- Ciudad de Destino -->
                                <div class="col-md-6 mb-3">
                                    <label for="nombreCiudadDestino" class="form-label">Ciudad de Destino *</label>
                                    <select id="nombreCiudadDestino"
                                            th:field="*{nombreCiudadDestino}"
                                            class="form-control"
                                            placeholder="Ej: Córdoba"
                                            required>
                                    </select>
                                    <small class="form-text text-muted">
                                        Escribí para buscar tu ciudad de destino
                                    </small>
                                </div>
                            </div>

                            <div class="row">
                                <!-- Fecha de salida -->
                                <div class="col-md-4 mb-3">
                                    <label for="fechaSalida" class="form-label">Desde qué fecha (opcional)</label>
                                    <input type="date"
                                           id="fechaSalida"
                                           th:field="*{fechaSalida}"
                                           class="form-control">
                                    <small class="form-text text-muted">
                                        Buscar viajes desde esta fecha en adelante
                                    </small>
                                </div>

                                <!-- Precio mínimo -->
                                <div class="col-md-4 mb-3">
                                    <label for="precioMin" class="form-label">Precio Mínimo ($)</label>
                                    <input type="number"
                                           id="precioMin"
                                           th:field="*{precioMin}"
                                           class="form-control"
                                           placeholder="Ej: 500"
                                           min="0"
                                           step="0.01">
                                    <small class="form-text text-muted">Opcional</small>
                                </div>

                                <!-- Precio máximo -->
                                <div class="col-md-4 mb-3">
                                    <label for="precioMax" class="form-label">Precio Máximo ($)</label>
                                    <input type="number"
                                           id="precioMax"
                                           th:field="*{precioMax}"
                                           class="form-control"
                                           placeholder="Ej: 2000"
                                           min="0"
                                           step="0.01">
                                    <small class="form-text text-muted">Opcional</small>
                                </div>
                            </div>

                            <!-- Botones -->
                            <div class="text-center mt-3">
                                <button type="submit" class="btn btn-unrumbo w-100 text-white fw-bold">
                                    Buscar Viajes
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Resultados de búsqueda -->
                    <div th:if="${resultados != null}" id="searchResults" class="mt-4">
                        <hr>
                        <h5 class="fw-bold text-dark mb-3">Resultados</h5>

                        <div th:if="${!resultados.isEmpty()}">
                            <div class="row">
                                <div th:each="viaje : ${resultados}" class="col-md-12 mb-3">
                                    <div class="card border-secondary">
                                        <div class="card-body">
                                            <div class="row align-items-center">
                                                <div class="col-md-8">
                                                    <h6 class="card-title fw-bold mb-2">
                                                        <span th:text="${viaje.origen}">Origen</span>
                                                        →
                                                        <span th:text="${viaje.destino}">Destino</span>
                                                    </h6>
                                                    <p class="mb-1">
                                                        <strong>Conductor:</strong>
                                                        <span th:text="${viaje.nombreConductor}">Sin conductor</span>
                                                    </p>
                                                    <p class="mb-1">
                                                        <strong>Fecha de salida:</strong>
                                                        <span th:text="${viaje.fechaSalida}">Sin fecha</span>
                                                    </p>
                                                    <p class="mb-1">
                                                        <strong>Asientos disponibles:</strong>
                                                        <span th:text="${viaje.asientosDisponibles}">0</span>
                                                    </p>
                                                    <p class="mb-0">
                                                        <strong>Estado:</strong>
                                                        <span class="badge"
                                                              th:classappend="${viaje.estado == 'DISPONIBLE'} ? 'bg-success' : 'bg-warning'"
                                                              th:text="${viaje.estado}">
                                                            DISPONIBLE
                                                        </span>
                                                    </p>
                                                </div>
                                                <div class="col-md-4 text-end">
                                                    <h5 class="text-unrumbo fw-bold mb-3" style="color:#E16A3D;">
                                                        $<span th:text="${viaje.precio}">0</span>
                                                    </h5>
                                                    <a th:href="@{/viaje/detalle(id=${viaje.id})}"
                                                       class="btn btn-sm btn-outline-primary">
                                                        Ver detalle
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Bootstrap core js -->
<script th:src="@{/webjars/bootstrap/5.2.0/js/bootstrap.bundle.min.js}"></script>
<script type="module" th:src="@{/js/buscarViaje.js}"></script>
</body>
</html>
